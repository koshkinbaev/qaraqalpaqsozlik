<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Qaraqalpaq_sózlik - Interaktiv</title>
  <!-- (senga yuborgan HTML ichidagi boshqa link/scriptlar shu yerda bo'ladi) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style> body { font-family: 'Roboto', sans-serif; } * { transition: background-color .25s ease, color .25s ease, border-color .25s ease, box-shadow .25s ease, transform .25s ease; } </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="root"></div>

  <script type="text/babel">
    // ... (React code as before) ...
    // IMPORTANT CHANGE: use relative endpoint "/api/gemini" so the Express server proxies requests.
    // I show only the modified ChatModal.send() function here — qolgan kodni o'zgartirmang

    // inside ChatModal component, replace the fetch(...) call with:
    async function send() {
      const text = input.trim();
      if (!text || loading) return;

      setErr("");
      setInput("");
      const next = [...messages, { role: "user", text }];
      setMessages(next);
      setLoading(true);

      try {
        const r = await fetch("/api/gemini", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: text,
            lang,
            context: "Bu sayt Qaraqalpaq_sózlik: so'zlar izohi, misollar va audio talaffuz."
          })
        });

        const data = await r.json();
        if (!r.ok) throw new Error(data?.error || "Request failed");

        setMessages(prev => [...prev, { role: "ai", text: data.text }]);
      } catch (e) {
        setErr(t.aiErr);
        setMessages(prev => [...prev, { role: "ai", text: t.aiFallback }]);
      } finally {
        setLoading(false);
      }
    }

    // rest of your React code remains unchanged; paste the original file content here, only replacing the fetch URL.
    // For brevity, include the rest of your existing HTML/React code in this file (unchanged).
  </script>
</body>
</html>
