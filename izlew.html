<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qaraqalpaq Sózlik — Pro</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#d6dbdb;
  margin:0; padding:0;
}
header{
  background:#2e3b4e;
  color:#fff;
  padding:20px;
  text-align:center;
}
.container{ width:90%; max-width:1100px; margin:20px auto; }

.search-box{
  display:flex; gap:10px; margin-bottom:10px;
}
.search-box input{
  flex:1; padding:12px; border-radius:8px; border:1px solid #000;
  font-size:16px;
}
.search-box button{
  padding:12px 16px; border-radius:8px; border:none;
  background:#2e3b4e; color:#fff; cursor:pointer;
}
.search-box button:hover{ background:#1a2434; }

#infoBar{ margin:10px 0; font-size:14px; color:#333; }

.word-card{
  display:flex;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.word-title{
  width:200px;
  background:#f0f0f0;
  display:flex; align-items:center; justify-content:center;
  font-weight:800; font-size:22px;
  padding:10px; text-align:center;
}
.word-details{ padding:12px; display:grid; gap:10px; flex:1; }
.meaning-box,.example-box{
  background:#f9f9f9;
  padding:10px; border-radius:8px; border:1px solid #000;
}

mark{ background:#ffeb3b; padding:0 4px; border-radius:4px; }

.pagination{
  display:flex; gap:8px; justify-content:center; margin:20px 0;
}
.pagination button{
  padding:8px 12px; border-radius:6px; border:1px solid #333;
  cursor:pointer; background:#fff;
}
.pagination button.active{
  background:#2e3b4e; color:#fff;
}

.word-card.active{
  outline:3px solid #2e3b4e;
}
</style>
</head>
<body>

<header>
  <h1>Qaraqalpaq Sózlik — Pro</h1>
  <p>Auto search · Pagination · Keyboard · Translit · Fuzzy</p>
</header>

<div class="container">
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Sóz izlew...">
    <button id="searchBtn">Izlew</button>
  </div>

  <div id="infoBar">Tayyor ✅</div>

  <div id="resultsContainer"></div>
  <div class="pagination" id="pagination"></div>
</div>

<script>
// ====== 1) DATA ======
const words = [
  {
    word: "Abay",
    meaning: "at. Qorǵanısh, saqlıq, es, abay-siyasat.",
    experience: "Sen bilmeysen meniń jayım, Onıń menen teń qudayım..."
  },
  {
    word: "Kitap",
    meaning: "Oqıw ushın basılǵan mátin.",
    experience: "Men kitap oqıwdı jaqsı kóremin."
  },
  {
    word: "Bilim",
    meaning: "Oqıw arqalı alınǵan maǵlıwmat.",
    experience: "Bilim — insannıń baylıǵı."
  }
  // bu yerga 1000+ so‘z qo‘shasiz
];

// ====== 2) SETTINGS ======
const PAGE_SIZE = 20;
let currentPage = 1;
let currentResults = [];
let selectedIndex = -1;
let debounceTimer = null;

// ====== 3) UTILS ======
function escapeHTML(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function normalize(str){
  return String(str ?? "").toLowerCase().trim();
}

// ====== 4) FUZZY ======
function levenshtein(a,b){
  a=normalize(a); b=normalize(b);
  if(a===b) return 0;
  const m=a.length,n=b.length;
  const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
  for(let i=0;i<=m;i++) dp[i][0]=i;
  for(let j=0;j<=n;j++) dp[0][j]=j;
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      const cost=a[i-1]===b[j-1]?0:1;
      dp[i][j]=Math.min(
        dp[i-1][j]+1,
        dp[i][j-1]+1,
        dp[i-1][j-1]+cost
      );
    }
  }
  return dp[m][n];
}
function score(term,text){
  term=normalize(term); text=normalize(text);
  if(text.includes(term)) return 1;
  const parts=text.split(/\s+/);
  let best=0;
  for(const p of parts){
    const d=levenshtein(term,p);
    const s=1-d/Math.max(term.length,p.length);
    if(s>best) best=s;
  }
  return best;
}

// ====== 5) SEARCH ======
function searchWord(){
  const q = document.getElementById("searchInput").value.trim();
  if(!q){
    currentResults = [];
    render();
    return;
  }

  const results=[];
  for(const w of words){
    const blob = `${w.word} ${w.meaning} ${w.experience}`;
    const s = score(q, blob);
    if(s>=0.6){
      results.push({w, s});
    }
  }
  results.sort((a,b)=>b.s-a.s);
  currentResults = results;
  currentPage = 1;
  selectedIndex = -1;
  render();
}

// ====== 6) RENDER ======
function highlight(text, term){
  const safe=escapeHTML(text);
  if(!term) return safe;
  const re=new RegExp(`(${term.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")})`,"ig");
  return safe.replace(re,"<mark>$1</mark>");
}

function render(){
  const container=document.getElementById("resultsContainer");
  const info=document.getElementById("infoBar");
  container.innerHTML="";

  if(currentResults.length===0){
    info.textContent="Natije joq.";
    return;
  }

  info.textContent=`Tabıldı: ${currentResults.length} ta`;

  const start=(currentPage-1)*PAGE_SIZE;
  const pageItems=currentResults.slice(start,start+PAGE_SIZE);

  pageItems.forEach((it,idx)=>{
    const w=it.w;
    const card=document.createElement("div");
    card.className="word-card";
    if(idx===selectedIndex) card.classList.add("active");

    card.innerHTML=`
      <div class="word-title">${highlight(w.word, document.getElementById("searchInput").value)}</div>
      <div class="word-details">
        <div class="meaning-box"><strong>Mánisi:</strong> ${highlight(w.meaning, document.getElementById("searchInput").value)}</div>
        <div class="example-box"><strong>Mısal:</strong> ${highlight(w.experience, document.getElementById("searchInput").value)}</div>
      </div>
    `;
    container.appendChild(card);
  });

  renderPagination();
}

function renderPagination(){
  const pag=document.getElementById("pagination");
  pag.innerHTML="";
  const pages=Math.ceil(currentResults.length/PAGE_SIZE);
  for(let i=1;i<=pages;i++){
    const btn=document.createElement("button");
    btn.textContent=i;
    if(i===currentPage) btn.classList.add("active");
    btn.onclick=()=>{ currentPage=i; selectedIndex=-1; render(); };
    pag.appendChild(btn);
  }
}

// ====== 7) EVENTS ======
document.getElementById("searchBtn").addEventListener("click", searchWord);

// Auto search (debounce)
document.getElementById("searchInput").addEventListener("input", ()=>{
  clearTimeout(debounceTimer);
  debounceTimer=setTimeout(searchWord, 300);
});

// Keyboard navigation
document.addEventListener("keydown", (e)=>{
  if(currentResults.length===0) return;
  const max = Math.min(PAGE_SIZE, currentResults.length - (currentPage-1)*PAGE_SIZE);

  if(e.key==="ArrowDown"){
    selectedIndex = Math.min(max-1, selectedIndex+1);
    render();
  }
  if(e.key==="ArrowUp"){
    selectedIndex = Math.max(0, selectedIndex-1);
    render();
  }
});
</script>

</body>
</html>

