<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Qaraqalpaq Qo‚Äòshiqlari</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e2e8f0;
      --accent:#2563eb;
      --accent2:#06b6d4;
      --shadow: 0 16px 50px rgba(2,6,23,.10);
      --radius: 20px;
    }

    .dark{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.75);
      --line:rgba(255,255,255,.12);
      --shadow: 0 18px 60px rgba(0,0,0,.35);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:Roboto,system-ui,-apple-system,Segoe UI,Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-tap-highlight-color: transparent;
      transition: background-color .25s ease, color .25s ease;
    }

    /* layout */
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 14px 70px;
    }

    .topbar{
      position: sticky;
      top:0;
      z-index:50;
      backdrop-filter: blur(14px);
      background: color-mix(in oklab, var(--bg) 82%, transparent);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      max-width:1100px;
      margin:0 auto;
      padding:14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
    }
    .logo{
      width:44px;height:44px;
      border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: var(--shadow);
      display:grid;
      place-items:center;
      color:white;
      font-weight:900;
      flex:0 0 auto;
    }
    .brand h1{
      margin:0;
      font-size: clamp(16px, 2.8vw, 22px);
      line-height:1.1;
      font-weight:900;
      letter-spacing:-.3px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex:0 0 auto;
    }

    .btn{
      border:1px solid var(--line);
      background: var(--card);
      color: var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 24px rgba(0,0,0,.05);
      transition: transform .15s ease, box-shadow .2s ease, background-color .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 40px rgba(0,0,0,.10); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent;
      color:white;
    }

    /* hero */
    .hero{
      margin-top:16px;
      background: radial-gradient(circle at 20% 20%, color-mix(in oklab, var(--accent) 35%, transparent), transparent 50%),
                  radial-gradient(circle at 80% 10%, color-mix(in oklab, var(--accent2) 35%, transparent), transparent 45%),
                  var(--card);
      border:1px solid var(--line);
      border-radius: calc(var(--radius) + 6px);
      box-shadow: var(--shadow);
      padding:18px;
    }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.4fr .6fr;
      gap:14px;
      align-items:center;
    }
    @media (max-width: 800px){
      .hero-grid{ grid-template-columns: 1fr; }
    }

    .searchbox{
      display:flex;
      gap:10px;
      align-items:center;
      background: color-mix(in oklab, var(--card) 80%, transparent);
      border:1px solid var(--line);
      border-radius: 18px;
      padding:10px 12px;
    }
    .searchbox input{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      font-weight:700;
      font-size:14px;
    }
    .searchbox small{
      color:var(--muted);
      font-weight:700;
      white-space:nowrap;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:14px;
    }

    .chip{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: var(--card);
      color: var(--text);
      font-weight:900;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      transition: transform .15s ease, background-color .2s ease, border-color .2s ease;
    }
    .chip:hover{ transform: translateY(-1px); }
    .chip.active{
      background: color-mix(in oklab, var(--accent) 16%, var(--card));
      border-color: color-mix(in oklab, var(--accent) 45%, var(--line));
    }

    /* A-Z bar */
    .az{
      margin-top:14px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .az button{
      width:38px;
      height:38px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: var(--card);
      color: var(--text);
      font-weight:900;
      cursor:pointer;
      transition: transform .15s ease, background-color .2s ease;
    }
    .az button:hover{ transform: translateY(-1px); }
    .az button.active{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent;
      color:white;
    }

    /* list */
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:14px;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: repeat(2,1fr);} }
    @media (max-width: 620px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 190px;
    }
    .card-top{
      padding:14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .title{
      margin:0;
      font-weight:900;
      letter-spacing:-.2px;
      line-height:1.2;
      font-size:16px;
    }
    .meta{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      font-weight:700;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .badge{
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: color-mix(in oklab, var(--card) 70%, transparent);
      font-weight:900;
      font-size:11px;
    }

    .fav{
      width:42px;
      height:42px;
      border-radius: 16px;
      border:1px solid var(--line);
      background: var(--card);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-size:18px;
      transition: transform .15s ease, background-color .2s ease;
      flex:0 0 auto;
    }
    .fav:hover{ transform: translateY(-1px); }
    .fav.active{
      background: color-mix(in oklab, #ef4444 18%, var(--card));
      border-color: color-mix(in oklab, #ef4444 40%, var(--line));
    }

    .player{
      margin-top:auto;
      border-top:1px solid var(--line);
      padding:12px 14px 14px;
      display:grid;
      gap:10px;
    }
    .controls{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .play{
      width:46px;height:46px;
      border-radius: 18px;
      border:none;
      cursor:pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:white;
      font-size:16px;
      font-weight:900;
      box-shadow: 0 18px 44px rgba(37,99,235,.22);
      transition: transform .15s ease;
    }
    .play:active{ transform: scale(.99); }

    .progress{
      width:100%;
      height:10px;
      background: color-mix(in oklab, var(--line) 70%, transparent);
      border-radius: 999px;
      overflow:hidden;
      cursor:pointer;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }

    .time{
      display:flex;
      justify-content:space-between;
      color:var(--muted);
      font-weight:800;
      font-size:12px;
    }

    .more{
      display:flex;
      gap:8px;
      align-items:center;
    }
    select{
      border:1px solid var(--line);
      background: var(--card);
      color:var(--text);
      border-radius: 14px;
      padding:9px 10px;
      font-weight:900;
      outline:none;
      cursor:pointer;
    }

    .mini{
      border:1px solid var(--line);
      background: var(--card);
      color:var(--text);
      border-radius: 14px;
      padding:9px 10px;
      font-weight:900;
      cursor:pointer;
    }

    /* empty state */
    .empty{
      margin-top:18px;
      border:1px dashed var(--line);
      border-radius: var(--radius);
      padding:22px;
      color:var(--muted);
      font-weight:800;
      text-align:center;
      background: color-mix(in oklab, var(--card) 80%, transparent);
    }

    /* modal */
    .modal{
      position:fixed;
      inset:0;
      z-index:999;
      display:none;
    }
    .modal.open{ display:block; }
    .modal-bg{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.55);
    }
    .modal-box{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%);
      width:min(720px, calc(100% - 26px));
      background: var(--card);
      border:1px solid var(--line);
      border-radius: 26px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--line);
    }
    .modal-head h3{
      margin:0;
      font-size:16px;
      font-weight:900;
    }
    .x{
      width:44px;height:44px;
      border-radius: 16px;
      border:1px solid var(--line);
      background: var(--card);
      cursor:pointer;
      font-weight:900;
      color:var(--text);
    }
    .modal-body{ padding:16px; color:var(--text); }
    .modal-body p{ margin:10px 0; color:var(--muted); font-weight:700; line-height:1.6; }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }

    /* floating buttons */
    .fab{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 80;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding-bottom: env(safe-area-inset-bottom);
    }
    .fab button{
      width:52px;
      height:52px;
      border-radius: 18px;
      border:1px solid var(--line);
      background: var(--card);
      color: var(--text);
      cursor:pointer;
      box-shadow: var(--shadow);
      font-size:18px;
      font-weight:900;
      transition: transform .15s ease;
      display:grid;
      place-items:center;
    }
    .fab button:hover{ transform: translateY(-1px); }
    .fab button.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent;
      color: white;
    }

    /* toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      z-index: 9999;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: color-mix(in oklab, var(--card) 85%, transparent);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      font-weight: 900;
      display:none;
      max-width: calc(100% - 20px);
      text-align:center;
    }
    .toast.show{ display:block; }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">üéµ</div>
        <div style="min-width:0">
          <h1>Qaraqalpaq Qo‚Äòshiqlari</h1>
          <p>Audio + qidiruv + sevimlilar ‚Ä¢ mobilga mos</p>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="favOnlyBtn" title="Only favorites">
          ‚ù§Ô∏è <span class="hide-sm">Sevimlilar</span>
        </button>
        <button class="btn" id="themeBtn" title="Theme">
          üåô <span class="hide-sm">Theme</span>
        </button>
        <button class="btn primary" id="addBtn" title="Add">
          ‚ûï <span class="hide-sm">Qo‚Äòshish</span>
        </button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <div class="hero-grid">
        <div>
          <div class="searchbox">
            üîé
            <input id="searchInput" type="text" placeholder="So‚Äòz / atƒ± / kategoriya boyƒ±nsha izle≈Ñ..." />
            <small id="countInfo">0 ta</small>
          </div>

          <div class="chips" id="chipRow">
            <!-- chips injected -->
          </div>

          <div class="az" id="azRow">
            <!-- a-z injected -->
          </div>
        </div>

        <div>
          <div style="display:grid; gap:10px;">
            <button class="btn primary" style="width:100%; justify-content:center;" id="openAllBtn">
              üìö H√°mmesin k√≥riw
            </button>
            <button class="btn" style="width:100%; justify-content:center;" id="clearSearchBtn">
              üßπ Qidiruvdƒ± tazalaw
            </button>
            <button class="btn" style="width:100%; justify-content:center;" id="shuffleBtn">
              üîÄ Random
            </button>
          </div>
          <div style="margin-top:12px; color:var(--muted); font-weight:800; font-size:12px; line-height:1.5;">
            üí° Tip: Haripke basƒ±≈Ñ ‚Äî tez tapsƒ±≈Ñƒ±z. ‚ù§Ô∏è basƒ±≈Ñ ‚Äî sevimlige saqlanadƒ±.
          </div>
        </div>
      </div>
    </div>

    <div class="grid" id="songGrid"></div>
    <div class="empty" id="emptyState" style="display:none;">Hech n√°rse tabƒ±lmadƒ± üòï Qidiruvdƒ± √≥zgertip k√≥ri≈Ñ.</div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-bg" id="modalBg"></div>
    <div class="modal-box">
      <div class="modal-head">
        <h3 id="modalTitle">Song</h3>
        <button class="x" id="modalClose">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="row" id="modalBadges"></div>
        <p id="modalDesc">...</p>
        <div class="row">
          <button class="btn primary" id="modalPlay">‚ñ∂Ô∏è Play</button>
          <button class="btn" id="modalOpenAudio">üéß Open audio</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">Saved ‚úÖ</div>

  <!-- Floating buttons -->
  <div class="fab">
    <button id="topBtn" title="Top">‚¨ÜÔ∏è</button>
    <button class="primary" id="helpBtn" title="Help">‚ùî</button>
  </div>

  <script>
    /***************
     * DATA (demo) *
     ***************/
    const songs = [
      // Siz shu yerga o'zingizdagi audio linklarni qo'shasiz:
      // audio: "audio/1.mp3" yoki https://....mp3
      { id: 1, title: "A ‚Äì √Ådebiyat", letter:"A", category:"A h√°ribi", audio:"audio/a1.mp3", desc:"Bul demo. S√≥zlik/qo‚Äòshiq tizimi ushƒ±n misal." },
      { id: 2, title: "B ‚Äì B√°yani", letter:"B", category:"B h√°ribi", audio:"audio/b1.mp3", desc:"Bul demo. Audio qoyƒ±p test qƒ±lƒ±≈Ñ." },
      { id: 3, title: "D ‚Äì D√°slepki", letter:"D", category:"D h√°ribi", audio:"audio/d1.mp3", desc:"Bul demo. Kategoriya boyƒ±nsha filter bar." },
      { id: 4, title: "E ‚Äì Eline", letter:"E", category:"E h√°ribi", audio:"audio/e1.mp3", desc:"Bul demo. Sevimlilar ‚ù§Ô∏è localStorage‚Äôda saqlanadƒ±." },
      { id: 5, title: "G ‚Äì G√∫listan", letter:"G", category:"G h√°ribi", audio:"audio/g1.mp3", desc:"Bul demo. Mobilda dizayn qulay." },
      { id: 6, title: "«¥ ‚Äì «¥alaba", letter:"«¥", category:"«¥ h√°ribi", audio:"audio/gh1.mp3", desc:"Bul demo. Harip boyƒ±nsha jump bar." },
      { id: 7, title: "J ‚Äì Jiyen", letter:"J", category:"J h√°ribi", audio:"audio/j1.mp3", desc:"Bul demo. Player: speed, progress, time." },
      { id: 8, title: "Z ‚Äì Zaman", letter:"Z", category:"Z h√°ribi", audio:"audio/z1.mp3", desc:"Bul demo. Modal detail bar." },
      { id: 9, title: "I ‚Äì Ilim", letter:"I", category:"I h√°ribi", audio:"audio/i1.mp3", desc:"Bul demo. Dark/Light theme bar." },
      { id:10, title: "Y ‚Äì Yurt", letter:"Y", category:"Y h√°ribi", audio:"audio/y1.mp3", desc:"Bul demo. Random shuffle bar." },
      { id:11, title: "K ‚Äì K√∫n", letter:"K", category:"K h√°ribi", audio:"audio/k1.mp3", desc:"Bul demo. Qidiruv real time." },
      { id:12, title: "Q ‚Äì Q√°dir", letter:"Q", category:"Q h√°ribi", audio:"audio/q1.mp3", desc:"Bul demo. Mobile responsive." },
      { id:13, title: "L ‚Äì Lirika", letter:"L", category:"L h√°ribi", audio:"audio/l1.mp3", desc:"Bul demo. O‚Äôzingiz audio qo‚Äôshing." },
    ];

    /******************
     * UI + STATE     *
     ******************/
    const els = {
      grid: document.getElementById("songGrid"),
      empty: document.getElementById("emptyState"),
      search: document.getElementById("searchInput"),
      count: document.getElementById("countInfo"),
      chipRow: document.getElementById("chipRow"),
      azRow: document.getElementById("azRow"),
      favOnlyBtn: document.getElementById("favOnlyBtn"),
      themeBtn: document.getElementById("themeBtn"),
      addBtn: document.getElementById("addBtn"),
      openAllBtn: document.getElementById("openAllBtn"),
      clearSearchBtn: document.getElementById("clearSearchBtn"),
      shuffleBtn: document.getElementById("shuffleBtn"),
      toast: document.getElementById("toast"),
      modal: document.getElementById("modal"),
      modalBg: document.getElementById("modalBg"),
      modalClose: document.getElementById("modalClose"),
      modalTitle: document.getElementById("modalTitle"),
      modalBadges: document.getElementById("modalBadges"),
      modalDesc: document.getElementById("modalDesc"),
      modalPlay: document.getElementById("modalPlay"),
      modalOpenAudio: document.getElementById("modalOpenAudio"),
      topBtn: document.getElementById("topBtn"),
      helpBtn: document.getElementById("helpBtn"),
    };

    const STORAGE = {
      theme: "qq_theme",
      favs: "qq_favs"
    };

    let state = {
      filter: "all",
      letter: "ALL",
      query: "",
      favOnly: false,
      playingId: null,
    };

    const categories = ["H√°mmesi","A h√°ribi","B h√°ribi","D h√°ribi","E h√°ribi","G h√°ribi","«¥ h√°ribi","J h√°ribi","Z h√°ribi","I h√°ribi","Y h√°ribi","K h√°ribi","Q h√°ribi","L h√°ribi"];
    const letters = ["ALL","A","B","D","E","G","«¥","J","Z","I","Y","K","Q","L"];

    function toast(text){
      els.toast.textContent = text;
      els.toast.classList.add("show");
      clearTimeout(window.__t);
      window.__t = setTimeout(()=>els.toast.classList.remove("show"), 1500);
    }

    function getFavs(){
      try{ return new Set(JSON.parse(localStorage.getItem(STORAGE.favs) || "[]")); }
      catch{ return new Set(); }
    }
    function setFavs(set){
      localStorage.setItem(STORAGE.favs, JSON.stringify([...set]));
    }

    // single global audio (only one plays)
    const audio = new Audio();
    audio.preload = "metadata";

    function formatTime(sec){
      if (!isFinite(sec)) return "0:00";
      const m = Math.floor(sec/60);
      const s = Math.floor(sec%60).toString().padStart(2,"0");
      return `${m}:${s}`;
    }

    function applyTheme(){
      const t = localStorage.getItem(STORAGE.theme) || "light";
      document.documentElement.classList.toggle("dark", t === "dark");
      els.themeBtn.innerHTML = (t === "dark" ? "‚òÄÔ∏è Theme" : "üåô Theme");
    }

    function toggleTheme(){
      const cur = localStorage.getItem(STORAGE.theme) || "light";
      localStorage.setItem(STORAGE.theme, cur === "dark" ? "light" : "dark");
      applyTheme();
      toast("Theme saqlandƒ± ‚úÖ");
    }

    function buildChips(){
      els.chipRow.innerHTML = "";
      categories.forEach((c, idx) => {
        const key = idx === 0 ? "all" : c;
        const b = document.createElement("div");
        b.className = "chip" + ((state.filter === key) ? " active" : "");
        b.textContent = c;
        b.onclick = () => {
          state.filter = key;
          toast("Filter ‚úîÔ∏è");
          render();
          buildChips();
        };
        els.chipRow.appendChild(b);
      });
    }

    function buildAZ(){
      els.azRow.innerHTML = "";
      letters.forEach(l => {
        const b = document.createElement("button");
        b.textContent = l === "ALL" ? "‚àû" : l;
        b.className = (state.letter === l ? "active" : "");
        b.onclick = () => {
          state.letter = l;
          toast("H√°rip ‚úîÔ∏è");
          render();
          buildAZ();
        };
        els.azRow.appendChild(b);
      });
    }

    function filteredSongs(){
      const favs = getFavs();
      const q = state.query.trim().toLowerCase();

      return songs.filter(s => {
        const byCat = state.filter === "all" ? true : (s.category === state.filter);
        const byLetter = state.letter === "ALL" ? true : (s.letter === state.letter);
        const byQuery = !q ? true : (
          s.title.toLowerCase().includes(q) ||
          s.category.toLowerCase().includes(q) ||
          (s.letter || "").toLowerCase().includes(q)
        );
        const byFav = state.favOnly ? favs.has(s.id) : true;
        return byCat && byLetter && byQuery && byFav;
      });
    }

    function openModal(song){
      els.modal.classList.add("open");
      els.modalTitle.textContent = song.title;
      els.modalDesc.textContent = song.desc || "‚Äî";
      els.modalBadges.innerHTML = `
        <span class="badge">H√°rip: ${song.letter}</span>
        <span class="badge">${song.category}</span>
        <span class="badge">${song.audio ? "Audio: bor" : "Audio: joq"}</span>
      `;

      els.modalPlay.onclick = () => playSong(song.id);
      els.modalOpenAudio.onclick = () => {
        if (!song.audio) return toast("Audio joq üòï");
        window.open(song.audio, "_blank");
      };
    }
    function closeModal(){ els.modal.classList.remove("open"); }

    function playSong(id){
      const song = songs.find(x => x.id === id);
      if (!song) return;

      if (!song.audio){
        toast("Audio joq üòï");
        return;
      }

      // toggle pause/play if same song
      if (state.playingId === id && !audio.paused){
        audio.pause();
        toast("Pause ‚è∏Ô∏è");
        render();
        return;
      }

      state.playingId = id;
      audio.src = song.audio;
      audio.play().then(()=>{
        toast("Play ‚ñ∂Ô∏è");
        render();
      }).catch(()=>{
        toast("Audio a√ßƒ±lmadƒ± ‚ö†Ô∏è");
      });
    }

    function stop(){
      audio.pause();
      audio.currentTime = 0;
      state.playingId = null;
      render();
    }

    function render(){
      const favs = getFavs();
      const list = filteredSongs();

      els.count.textContent = `${list.length} ta`;
      els.grid.innerHTML = "";
      els.empty.style.display = list.length ? "none" : "block";

      list.forEach(song => {
        const isFav = favs.has(song.id);
        const isPlaying = state.playingId === song.id && !audio.paused;

        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <div class="card-top">
            <div style="min-width:0;">
              <h3 class="title">${song.title}</h3>
              <div class="meta">
                <span class="badge">${song.category}</span>
                <span class="badge">H√°rip: ${song.letter}</span>
              </div>
            </div>
            <button class="fav ${isFav ? "active" : ""}" title="Favorite">${isFav ? "‚ù§Ô∏è" : "ü§ç"}</button>
          </div>

          <div class="player">
            <div class="controls">
              <button class="play" title="Play">${isPlaying ? "‚è∏" : "‚ñ∂Ô∏è"}</button>

              <div class="more">
                <select class="speed" title="Speed">
                  <option value="0.75">0.75x</option>
                  <option value="1" selected>1x</option>
                  <option value="1.25">1.25x</option>
                  <option value="1.5">1.5x</option>
                </select>
                <button class="mini info" title="Info">‚ÑπÔ∏è</button>
                <button class="mini stop" title="Stop">‚èπÔ∏è</button>
              </div>
            </div>

            <div class="progress" title="Seek">
              <div class="bar" style="width:${getProgress(song.id)}%"></div>
            </div>

            <div class="time">
              <span>${getTimeLabel(song.id).cur}</span>
              <span>${getTimeLabel(song.id).dur}</span>
            </div>
          </div>
        `;

        // events
        const favBtn = card.querySelector(".fav");
        const playBtn = card.querySelector(".play");
        const stopBtn = card.querySelector(".stop");
        const infoBtn = card.querySelector(".info");
        const speedSel = card.querySelector(".speed");
        const progress = card.querySelector(".progress");

        favBtn.onclick = () => {
          const set = getFavs();
          if (set.has(song.id)) set.delete(song.id);
          else set.add(song.id);
          setFavs(set);
          toast(set.has(song.id) ? "Sevimlige saqlandƒ± ‚ù§Ô∏è" : "Sevimliden √≥shirildi ü§ç");
          render();
        };

        playBtn.onclick = () => playSong(song.id);
        stopBtn.onclick = () => stop();
        infoBtn.onclick = () => openModal(song);

        speedSel.onchange = () => {
          if (state.playingId === song.id) {
            audio.playbackRate = Number(speedSel.value);
            toast("Speed: " + speedSel.value + "x");
          } else {
            toast("Alƒ±nƒ±p oynap tur«µanda speed √≥zgeredi üéß");
          }
        };

        progress.onclick = (e) => {
          if (state.playingId !== song.id) return;
          const rect = progress.getBoundingClientRect();
          const p = Math.min(1, Math.max(0, (e.clientX - rect.left) / rect.width));
          audio.currentTime = p * (audio.duration || 0);
          render();
        };

        els.grid.appendChild(card);
      });
    }

    function getProgress(id){
      if (state.playingId !== id) return 0;
      if (!audio.duration) return 0;
      return (audio.currentTime / audio.duration) * 100;
    }

    function getTimeLabel(id){
      if (state.playingId !== id) return {cur:"0:00", dur:"0:00"};
      return {cur: formatTime(audio.currentTime), dur: formatTime(audio.duration)};
    }

    // update UI while playing
    audio.addEventListener("timeupdate", () => {
      // light render only when playing
      if (state.playingId) render();
    });
    audio.addEventListener("ended", () => {
      toast("Tawƒ±sƒ± bitti ‚úÖ");
      state.playingId = null;
      render();
    });

    // search
    els.search.addEventListener("input", (e) => {
      state.query = e.target.value;
      render();
    });
    els.search.addEventListener("keydown", (e) => {
      if (e.key === "Escape"){
        els.search.value = "";
        state.query = "";
        render();
      }
    });

    // buttons
    els.favOnlyBtn.onclick = () => {
      state.favOnly = !state.favOnly;
      els.favOnlyBtn.classList.toggle("primary", state.favOnly);
      toast(state.favOnly ? "Faqat ‚ù§Ô∏è sevimlilar" : "B√°rin k√≥rsetiw");
      render();
    };
    els.themeBtn.onclick = toggleTheme;

    els.openAllBtn.onclick = () => {
      state.filter = "all";
      state.letter = "ALL";
      state.query = "";
      els.search.value = "";
      state.favOnly = false;
      toast("H√°mmesi qaytadan ‚úÖ");
      buildChips();
      buildAZ();
      render();
    };

    els.clearSearchBtn.onclick = () => {
      els.search.value = "";
      state.query = "";
      toast("Tazalandi üßπ");
      render();
    };

    els.shuffleBtn.onclick = () => {
      // simple shuffle (view only)
      songs.sort(() => Math.random() - 0.5);
      toast("Random üîÄ");
      render();
    };

    // "Add" demo
    els.addBtn.onclick = () => {
      toast("Qo‚Äòshiw: keyin admin panel qƒ±lamƒ±z üòâ");
      openModal({
        title: "Qo‚Äòshiq qo‚Äòshish (demo)",
        letter: "‚Äî",
        category: "‚Äî",
        audio: "",
        desc: "Agar xohlasangiz, men sizga admin uchun 'Qo‚Äòshiq qo‚Äòshish formasi' + localStorage/JSON bazaga yozib beraman."
      });
    };

    // modal close
    els.modalBg.onclick = closeModal;
    els.modalClose.onclick = closeModal;
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModal();
    });

    // top button
    els.topBtn.onclick = () => window.scrollTo({ top:0, behavior:"smooth" });
    window.addEventListener("scroll", () => {
      els.topBtn.style.opacity = window.scrollY > 450 ? "1" : ".35";
    }, { passive:true });

    // help
    els.helpBtn.onclick = () => {
      openModal({
        title: "Qanday paydalanƒ±w?",
        letter:"‚Äî",
        category:"‚Äî",
        audio:"",
        desc: "1) Qƒ±dƒ±rƒ±w: joqarƒ±da s√≥z jazƒ±≈Ñ.\n2) Kategoriya/harip boyƒ±nsha filter.\n3) ‚ù§Ô∏è sevimlige saqlaw.\n4) ‚ñ∂Ô∏è oynatƒ±w, progress basƒ±p tez √≥tiw.\n5) Speed: 0.75x‚Äì1.5x."
      });
    };

    // init
    applyTheme();
    buildChips();
    buildAZ();
    render();
    toast("Sayt tayyor ‚úÖ");
  </script>
</body>
</html>
